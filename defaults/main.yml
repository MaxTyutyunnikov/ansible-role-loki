---
# loki version to install
loki_version: 'latest'

# loki bins to install
loki_bins:
  - loki
  - logcli
  - promtail

loki_user: loki
loki_group: loki
loki_config_dir: /etc/loki
loki_storage_dir: /var/lib/loki

loki_tags: []

loki_listen_address: '127.0.0.1'
loki_listen_port: '3100'

loki_binary_local_dir: ''

loki_target: all
loki_auth_enabled: false

loki_server_config:
  http_listen_address: "{{ loki_listen_address }}"
  http_listen_port: "{{ loki_listen_port }}"

loki_distributor_config: []
loki_querier_config: []
loki_ingester_client_config: []
loki_ingester_config:
  lifecycler:
    address: 127.0.0.1
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
    final_sleep: 0s
  chunk_idle_period: 5m
  chunk_retain_period: 30s

loki_storage_config:
  boltdb:
    directory: "{{ loki_storage_dir }}/index"
  filesystem:
    directory: "{{ loki_storage_dir }}/chunks"

loki_chunk_store_config:
  max_look_back_period: 0

loki_schema_config:
  configs:
  - from: 2020-01-01
    store: boltdb
    object_store: filesystem
    schema: v11
    index:
      prefix: loki
      period: 168h

    chunks:
      prefix: loki
      period: 168h
    row_shards: 16

loki_limits_config: []
loki_frontend_worker_config: []
loki_runtime_config: []
loki_table_manager_config:
  chunk_tables_provisioning:
    inactive_read_throughput: 0
    inactive_write_throughput: 0
    provisioned_read_throughput: 0
    provisioned_write_throughput: 0
  index_tables_provisioning:
    inactive_read_throughput: 0
    inactive_write_throughput: 0
    provisioned_read_throughput: 0
    provisioned_write_throughput: 0
  retention_deletes_enabled: false
  retention_period: 0


promtail_client_config:
  - url: "http://{{ loki_listen_address }}:{{ loki_listen_port }}/loki/api/v1/push"

promtail_server_config:
  http_listen_port: 9080
  grpc_listen_port: 0

promtail_scrape_config:
  - job_name: system
    pipeline_stages:
    static_configs:
    - targets:
        - localhost
      labels:
        job: varlogs
        host: "{{ ansible_hostname }}"
        __path__: /var/log/*.log

  - job_name: journal
    journal:
      max_age: 12h
      labels:
        job: systemd-journal
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        target_label: 'unit'

promtail_target_config: []